name: Deploy Hexo Blog

on:
  push:
    branches:
      - main
      # ğŸš¨ ä¼˜åŒ–1ï¼šç¡®ä¿åªå¯¹ä¸»è¦çš„ Hexo æºä»£ç ä»“åº“è¿›è¡Œæ„å»º
      # åªæœ‰å½“ä½ åœ¨æœ¬åœ°æˆ–æ‰‹æœºä¸Šæäº¤æ–‡ä»¶åˆ° main åˆ†æ”¯æ—¶æ‰è§¦å‘éƒ¨ç½²

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Source (Fetch Submodules)
        uses: actions/checkout@v4
        with:
          # âœ… ä¿®å¤å…³é”®é”™è¯¯ï¼šå¯ç”¨å­æ¨¡å—æ‹‰å–ï¼Œç¡®ä¿ä¸»é¢˜æ–‡ä»¶è¢«ä¸‹è½½
          submodules: true 
          # ç¡®ä¿æ‹‰å–å®Œæ•´çš„å†å²è®°å½•ï¼Œæœ‰åŠ©äºæ­£ç¡®å¤„ç†å­æ¨¡å—
          fetch-depth: 0 

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: Configure Git Credentials
        run: |
          # é…ç½® Git ä¿¡æ¯ï¼Œç¡®ä¿éƒ¨ç½²æäº¤è®°å½•æ¸…æ™°
          git config --global user.email "41898282+github-actions[bot]@users.noreply.github.com"
          git config --global user.name "github-actions[bot]"

      - name: Install dependencies
        run: |
          npm install
          # ğŸš¨ ä¼˜åŒ–2ï¼šé¢„å…ˆå®‰è£… Hexo-CLIï¼Œç¡®ä¿æ‰€æœ‰ Hexo å‘½ä»¤å¯ç”¨
          npm install hexo-cli -g

      - name: Deploy to GitHub Pages
        run: |
          # 1. ç¡®ä¿å®‰è£…äº†éƒ¨ç½²æ’ä»¶
          npm install hexo-deployer-git
          
          # 2. æ¸…ç†å’Œç”Ÿæˆé™æ€æ–‡ä»¶
          npx hexo clean
          npx hexo generate
          
          # 3. éƒ¨ç½²åˆ°ç›®æ ‡ä»“åº“
          # ğŸš¨ ä¼˜åŒ–3ï¼šä½¿ç”¨æ ‡å‡†çš„ Hexo éƒ¨ç½²å‘½ä»¤ï¼Œå®ƒä¼šè¯»å– _config.yml ä¸­çš„é…ç½®
          # åªè¦ä½ æœ¬åœ°çš„ _config.yml é…ç½®æ­£ç¡®ï¼ŒActionså°±ä¼šä½¿ç”¨å®ƒ
          npx hexo deploy
          
        env:
          # å°† GitHub Pages ä»“åº“çš„ Personal Access Token æ³¨å…¥åˆ°ç¯å¢ƒå˜é‡ä¸­
          # Hexo Deployer Git æ’ä»¶ä¼šè‡ªåŠ¨è¯»å–è¿™ä¸ªå˜é‡è¿›è¡Œèº«ä»½éªŒè¯
          # âš ï¸ æ³¨æ„ï¼šè¿™è¦æ±‚ä½ åœ¨ GitHub ä»“åº“ Settings > Secrets ä¸­è®¾ç½®åä¸º DEPLOY_TOKEN çš„å¯†é’¥
          GIT_DEPLOY_TOKEN: ${{ secrets.DEPLOY_TOKEN }}