name: Deploy Hexo Blog

on:
  push:
    branches:
      - main
      # ğŸš¨ ä¼˜åŒ–1ï¼šç¡®ä¿åªå¯¹ä¸»è¦çš„ Hexo æºä»£ç ä»“åº“è¿›è¡Œæ„å»º
      # åªæœ‰å½“ä½ åœ¨æœ¬åœ°æˆ–æ‰‹æœºä¸Šæäº¤æ–‡ä»¶åˆ° main åˆ†æ”¯æ—¶æ‰è§¦å‘éƒ¨ç½²

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Source (Fetch Submodules)
        uses: actions/checkout@v4
        with:
          # âœ… ä¿®å¤å…³é”®é”™è¯¯ï¼šå¯ç”¨å­æ¨¡å—æ‹‰å–ï¼Œç¡®ä¿ä¸»é¢˜æ–‡ä»¶è¢«ä¸‹è½½
          submodules: true 
          # ç¡®ä¿æ‹‰å–å®Œæ•´çš„å†å²è®°å½•ï¼Œæœ‰åŠ©äºæ­£ç¡®å¤„ç†å­æ¨¡å—
          fetch-depth: 0 

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: Configure Git Credentials
        run: |
          # é…ç½® Git ä¿¡æ¯ï¼Œç¡®ä¿éƒ¨ç½²æäº¤è®°å½•æ¸…æ™°
          git config --global user.email "41898282+github-actions[bot]@users.noreply.github.com"
          git config --global user.name "github-actions[bot]"

      - name: Install dependencies
        run: |
          npm install
          # ğŸš¨ ä¼˜åŒ–2ï¼šé¢„å…ˆå®‰è£… Hexo-CLIï¼Œç¡®ä¿æ‰€æœ‰ Hexo å‘½ä»¤å¯ç”¨
          npm install hexo-cli -g

      - name: Deploy to GitHub Pages
        run: |
          # 1. ç¡®ä¿å®‰è£…äº†éƒ¨ç½²æ’ä»¶
          npm install hexo-deployer-git
          
          # 2. æ¸…ç†å’Œç”Ÿæˆé™æ€æ–‡ä»¶
          npx hexo clean
          npx hexo generate
          
          # 3. éƒ¨ç½²åˆ°ç›®æ ‡ä»“åº“
          # âš ï¸ å…³é”®ä¿®å¤ï¼šç›´æ¥åœ¨ URL ä¸­ä½¿ç”¨ DEPLOY_TOKEN è¿›è¡Œèº«ä»½éªŒè¯
          # è¿™ç»•è¿‡äº†å›  Actions ç¯å¢ƒæ— æ³•è¯»å–ç”¨æˆ·å/å¯†ç æç¤ºè€Œå¯¼è‡´çš„è®¤è¯å¤±è´¥
          npx hexo deploy --repo https://${{ secrets.DEPLOY_TOKEN }}@github.com/RCsCC/RCsCC.github.io.git
          
        env:
          # ä»…ä½¿ç”¨ GIT_DEPLOY_TOKEN ç¯å¢ƒå˜é‡ï¼Œç¡®ä¿ Hexo Deployer Git æ’ä»¶èƒ½è¯†åˆ«
          GIT_DEPLOY_TOKEN: ${{ secrets.DEPLOY_TOKEN }}